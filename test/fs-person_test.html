<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <script src="../../webcomponentsjs/webcomponents.js"></script>
    <script src="../../web-component-tester/browser.js"></script>

    <!-- Step 1: import the element to test -->
    <link rel="import" href="../styles-wc.html">

  </head>
  <body>

    <!-- You can use the document as a place to set up your fixtures. -->
    <test-fixture id="fs-person-default">
      <template>
        <fs-person></fs-person>
      </template>
    </test-fixture>

    <test-fixture id="fs-person-passed-values">
      <template>
        <fs-person
          colored-icon
          first-name = "John Jacob"
          full-name = "John Jacob Schmidt"
          gender = "male"
          hide-gender
          hide-pid
          inline
          last-name = "Schmidt"
          lifespan = "1800-1900"
          name-system = "sinotypic"
          orientation = "portrait"
          pid = "PID"
          portrait-url = "portraitUrl"
        ></fs-person>
      </template>
    </test-fixture>

    <test-fixture id="fs-person-set-show-portrait">
      <template>
        <fs-person show-portrait></fs-person>
      </template>
    </test-fixture>

    <script>
    (function(){
      describe('<fs-person>', function() {
        var fsPersonDefault;
        var fsPersonPassedValues;
        var fsPersonSetShowPortrait;

        beforeEach(function() {
          fsPersonDefault = fixture('fs-person-default');
          fsPersonPassedValues = fixture('fs-person-passed-values');
          fsPersonSetShowPortrait = fixture('fs-person-set-show-portrait');
        });

        describe('properties', function() {
          it('should set default values for "coloredIcon", "firstName", "fullName", "gender", "hideGender", "hidePid", "inline", "lastName", "lifespan", "nameSystem", "orientation", "pid", "portraitUrl", and "showPortrait" properties', function() {
            expect(fsPersonDefault.coloredIcon, "coloredIcon is not false").to.be.false;
            expect(fsPersonDefault.firstName, "firstName is not ''").to.equal('');
            expect(fsPersonDefault.fullName, "fullName is not ''").to.equal('');
            expect(fsPersonDefault.gender, "gender is not ''").to.equal('');
            expect(fsPersonDefault.hideGender, "hideGender is not false").to.be.false;
            expect(fsPersonDefault.hidePid, "hidePid is not false").to.be.false;
            expect(fsPersonDefault.inline, "inline is not false").to.be.false;
            expect(fsPersonDefault.lastName, "lastName is not ''").to.equal('');
            expect(fsPersonDefault.lifespan, "lifespan is not ''").to.equal('');
            expect(fsPersonDefault.nameSystem, "nameSystem is not ''").to.equal('eurotypic');
            expect(fsPersonDefault.orientation, "orientation is not 'landscape'").to.equal('landscape');
            expect(fsPersonDefault.pid, "pid is not ''").to.equal('');
            expect(fsPersonDefault.portraitUrl, "portraitUrl is not ''").to.equal('');
            expect(fsPersonDefault.showPortrait, "showPortrait is not false").to.be.false;
          });

          it('should have coloredIcon true', function () {
            expect(fsPersonPassedValues.coloredIcon, "coloredIcon is not true").to.be.true;
          });

          it('should set firstName', function () {
            expect(fsPersonPassedValues.firstName, "firstName is not set correctly").to.equal('John Jacob');
          });

          it('should set fullName', function () {
            expect(fsPersonPassedValues.fullName, "fullName is not set correctly").to.equal('John Jacob Schmidt');
          });

          it('should set gender', function () {
            expect(fsPersonPassedValues.gender, "gender is not set correctly").to.equal('male');
          });

          it('should hide gender and pid ', function () {
            expect(fsPersonPassedValues.hideGender, "hideGender is not true").to.be.true;
            expect(fsPersonPassedValues.hidePid, "hidePid is not true").to.be.true;
          });

          it('should be inline ', function () {
            expect(fsPersonPassedValues.inline, "inline is not true").to.be.true;
          });

          it('should set lastName', function () {
            expect(fsPersonPassedValues.lastName, "lastName is not set correctly").to.equal('Schmidt');
          });

          it('should set lifespan', function () {
            expect(fsPersonPassedValues.lifespan, "lifespan is not set correctly").to.equal('1800-1900');
          });

          it('should set nameSystem', function () {
            expect(fsPersonPassedValues.nameSystem, "nameSystem is not set correctly").to.equal('sinotypic');
          });

          it('should set orientation to portrait & showPortrait to true', function () {
            expect(fsPersonPassedValues.orientation, "orientation is not 'portrait'").to.equal('portrait');
            expect(fsPersonPassedValues.showPortrait, "showPortrait is not true").to.be.true;
          });

          it('should set pid', function () {
            expect(fsPersonPassedValues.pid, "pid is not set correctly").to.equal('PID');
          });

          it('should set portraitUrl', function () {
            expect(fsPersonPassedValues.portraitUrl, "portraitUrl is not set correctly").to.equal('portraitUrl');
          });

          it('should set showPortrait to true without changing orientation to "portrait"', function () {
            expect(fsPersonSetShowPortrait.orientation, "orientation is not 'portrait'").to.not.equal('portrait');
            expect(fsPersonSetShowPortrait.showPortrait, "showPortrait is not true").to.be.true;
          });
        });

        describe('handlePortraitError', function() {
          it('should set portraitUrl to false', function () {
            expect(fsPersonPassedValues.portraitUrl, "portraitUrl is not set correctly").to.equal('portraitUrl');

            fsPersonPassedValues.handlePortraitError({});

            expect(fsPersonPassedValues.portraitUrl, "portraitUrl is not false").to.be.false;
          });
        });

        describe('_and', function() {
          it('should return a and b', function () {
            expect(fsPersonDefault._and(true, true), "true & true returned false").to.be.true;
            expect(fsPersonDefault._and(true, false), "true & false returned true").to.be.false;
            expect(fsPersonDefault._and(false, true), "false & true returned true").to.be.false;
            expect(fsPersonDefault._and(false, false), "false & false returned true").to.be.false;
          });
        });

        describe('_copyPid', function() {
          var mockEvent;
          var preventDefaultStub;
          var stopImmediatePropagationStub;
          var execCommandSpy;

          beforeEach(function() {
            mockEvent = {
              preventDefault: function(){},
              stopImmediatePropagation: function(){}
            };

            preventDefaultStub = sinon.stub(mockEvent, "preventDefault");
            stopImmediatePropagationStub = sinon.stub(mockEvent, "stopImmediatePropagation");
            execCommandSpy = sinon.spy(document, "execCommand");
          });

          afterEach(function() {
            preventDefaultStub.restore();
            stopImmediatePropagationStub.restore();
            execCommandSpy.restore();

            delete mockEvent;
          });

          it('should call e.preventDefault()', function () {
            fsPersonDefault._copyPid(mockEvent);

            expect(preventDefaultStub.callCount, "_copyPid did not call preventDefault only once").to.equal(1);
          });

          it('should call e.stopImmediatePropagation()', function () {
            fsPersonDefault._copyPid(mockEvent);

            expect(preventDefaultStub.callCount, "_copyPid did not call stopImmediatePropagation only once").to.equal(1);
          });

          it('should call document.execCommand()', function () {
            fsPersonDefault._copyPid(mockEvent);

            expect(execCommandSpy.callCount, "_copyPid did not call execCommand only once").to.equal(1);
            expect(execCommandSpy.calledWith("copy"), "_copyPid did not call execCommand with the correct parameters").to.be.true;
          });
        });

        describe('_showPid', function() {
          it('should show the pid', function () {
            expect(fsPersonDefault._showPid(true, false), "pid exists and don't hide it returned false").to.be.true;
          });

          it('should not show pid', function () {
            expect(fsPersonDefault._showPid(true, true), "pid exists and hide it returned true").to.be.false;
            expect(fsPersonDefault._showPid(false, true), "no pid exists and hide it returned true").to.be.false;
            expect(fsPersonDefault._showPid(false, false), "no pid exists and don't hide it returned true").to.be.false;
          });
        });
      });
    })();
    </script>
  </body>
</html>
